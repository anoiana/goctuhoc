---
title: "ğŸ“Cáº¥u trÃºc dá»¯ liá»‡u trong R vÃ  vÃ²ng láº·p"
subtitle: "R Programming"
author: ğŸ‘¦ $\mathcal{An}$
date: "ğŸ“…`r format(Sys.Date(), format = '%B %d, %Y')`"
header-includes:
   - \usepackage{amsmath}
   - \usepackage{titling}
   - \pretitle{\begin{flushleft}}
   - \posttitle{\end{flushleft}}
   - \usepackage{eso-pic,graphicx,transparent}
output: 
    bookdown::html_document2:
      fig_caption: yes
      theme: default
      highlight: "tango"
      toc: true
      toc_float: 
        collapsed: false
      toc_depth: 3
      css: "../00_supp/style.css"
      number_sections: yes
      includes:
        in_header: "../00_supp/header.html"
        before_body: "test.html"
fontsize: 12pt
bibliography: ["citation.bib"]
csl: "../00_supp/apa.csl"
link-citations: true
editor_options: 
  chunk_output_type: console
---

\newcommand{\bf}[1]{\boldsymbol{#1}}
\newcommand{\hat}[1]{\widehat{#1}}
\newcommand{\mm}[1]{\mathbb{#1}}
\newcommand{\bar}[1]{\overline{#1}}
\def\E{\mathbb{E}}
\def\V{\mathbb{V}}
\def\P{\mathbb{P}}
\def\I{\mathbb{I}}
\def\indep{\perp\!\!\!\!\perp}

```{css, echo = F}
.watermark {
  opacity: 0.1;
  position: fixed;
  top: 50%;
  left: 50%;
  font-size: 500%;
  color: #7d0040;
}

.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}

/*----------LOGO above TOC---------*/

#TOC::before {
  content: "";
  display: block;
  height: 200px;
  margin: 2.75em 20px 40px 20px;
  background-image: url("r.jpg");
  background-size: contain;
  background-position: center center;
  background-repeat: no-repeat;
}
```
::: {.watermark} 
_DRAFT_
:::
 

```{r setup, include=FALSE, message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", class.output="scroll-300")
#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+
# fig label: fig1 on r chunk
# formula label: (\#eq:f01)       
# call it: \@ref(fig: label) 
# hightlights word: `package`
#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+#+
if(!require(pacman)) install.packages("pacman");library(pacman);p_load(
tidyverse, haven, magrittr, furrr,Hmisc, grid, ggplotify, forestplot, knitr, kableExtra, DT, network, sna
)
source("../00_supp/anh_functions.R")
draw_table = purrr::partial(reactable::reactable,bordered = TRUE, striped = TRUE, highlight = TRUE)
```
***
 
# Má»Ÿ Ä‘áº§u

Trong bÃ i nÃ y mÃ¬nh sáº½ khÃ¡i quÃ¡t láº¡i cáº¥u trÃºc trong láº­p trÃ¬nh cá»§a R. Tiáº¿p theo lÃ  giá»›i thiá»‡u cÃ¡c hÃ m trong gia Ä‘Ã¬nh `apply`, má»™t nhÃ³m bao gá»“m cÃ¡c hÃ m sá»­ dá»¥ng thay cho `for` náº¿u vÃ²ng láº·p thuá»™c nhÃ³m láº·p Ä‘á»™c láº­p. ThÃ´ng qua bÃ i nÃ y sáº½ giÃºp cÃ¡c báº¡n cÃ³ cÃ¡i nhÃ¬n tá»•ng quÃ¡t hÆ¡n vá» láº­p trÃ¬nh trong R vÃ  sáº½ biáº¿t dÃ¹ng cÃ¡c vÃ²ng loop tháº¿ nÃ o mang láº¡i hiá»‡u quáº£ nháº¥t trong tá»«ng trÆ°á»ng há»£p riÃªng biá»‡t. BÃ i nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c chia lÃ m 2 hoáº·c 3 bÃ i, tÃ¹y thuá»™c vÃ o ná»™i dung mÃ¬nh chia sáº½ cho tá»«ng pháº§n lÃ  dÃ i hay ngáº¯n. 

# CÃ¡c objects trong R 

Náº¿u cÃ¡c báº¡n Ä‘Ã£ tá»«ng há»c qua lá»›p Ä‘áº¡i sá»‘ tuyáº¿n tÃ­nh thÃ¬ háº³n lÃ  báº¡n sáº½ cáº£m tháº¥y R vÃ´ cÃ¹ng thÃº vá»‹, vÃ¬ cÃ¡ch mÃ  R váº­n hÃ nh Ä‘á»ƒ lÆ°u trá»¯ cÅ©ng nhÆ° láº­p trÃ¬nh khÃ¡ tÆ°Æ¡ng Ä‘á»“ng vá»›i cÃ¡c khÃ¡i niá»‡m trong mÃ´n há»c nÃ y. Äáº§u tiÃªn chÃºng ta sáº½ nÃ³i vá» cÃ¡c loáº¡i biáº¿n trong R

## PhÃ¢n loáº¡i biáº¿n 

cÃ¡c biáº¿n Ä‘Æ°á»£c dÃ¹ng trong R bao gá»“m

- `integer`: bao gá»“m cÃ¡c sá»‘ nguyÃªn nhÆ° $\dots,-2,-1,0,1,2,\dots$.
- `numeric`: Bao gá»“m táº¥t cáº£ cÃ¡c sá»‘ nguyÃªn vÃ  tháº­p phÃ¢n, tÆ°Æ¡ng tá»± nhÆ° biáº¿n liÃªn tá»¥c trong thá»‘ng kÃª.
- `character`: cÃ¡c loáº¡i biáº¿n vá» kÃ½ tá»± nhÆ° $A,a,B,b,C,c,\dots$, thÆ°á»ng dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ nhá»¯ng kÃ½ hiá»‡u, chÃº thÃ­ch, vÄƒn báº£n.
- factor: tÆ°Æ¡ng á»©ng vá»›i biáº¿n rá»i ráº¡c trong thá»‘ng kÃª. thÆ°á»ng trong má»™t data Ä‘á»‘i vá»›i biáº¿n rá»i ráº¡c nhÆ° giá»›i tÃ­nh, dÃ¢n tá»™c, quá»‘c gia ngÆ°á»i ta hay lÆ°u trá»¯ á»Ÿ dáº¡ng factor Ä‘á»ƒ cÃ³ thá»ƒ dá»… dÃ ng tÃ­nh toÃ¡n cÃ¡c sá»‘ liá»‡u thá»‘ng kÃª.
- logical: tÆ°Æ¡ng á»©ng vá»›i hÃ m sá»‘ indicator Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau 

$$
\I(X \in A) = \cases{1, \text{ náº¿u } X\in A \\
0, \text{ náº¿u } X\notin A}
$$

2 giÃ¡ trá»‹ cá»§a loáº¡i biáº¿n nÃ y Ä‘Æ°á»£c biá»ƒu thá»‹ dÆ°á»›i 2 hÃ¬nh thá»©c `TRUE` vÃ  `FALSE` trong Ä‘Ã³ `TRUE` tÆ°Æ¡ng á»©ng vá»›i 1, cÃ²n `FALSE` tÆ°Æ¡ng á»©ng vá»›i 0. loáº¡i biáº¿n nÃ y Ä‘Æ°á»£c dÃ¹ng ráº¥t nhiá»u trong quÃ¡ trÃ¬nh chá»n lá»c data cÅ©ng nhÆ° khi lÃ m viá»‡c vá»›i hÃ m `if`.

CÃ¡c loáº¡i biáº¿n trÃªn láº§n lÆ°á»£c Ä‘Æ°á»£c dÃ¹ng trong nhá»¯ng trÆ°á»ng há»£p khÃ¡c nhau. Má»—i má»™t giÃ¡ trá»‹ nÃ o Ä‘Ã³ thuá»™c má»™t trong nhá»¯ng loáº¡i biáº¿n nÃ y Ä‘Æ°á»£c xem lÃ  1 giÃ¡ trá»‹ vÃ´ hÆ°á»›ng (scalar). Náº¿u nhÆ° ta cÃ³ nhiá»u giÃ¡ trá»‹ vÃ´ hÆ°á»›ng thÃ¬ ta lÆ°u trá»¯ nhÆ° tháº¿ nÃ o? tiáº¿p theo ta sáº½ lÃ m quen vá»›i cÃ¡c objects dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c scalar 

## LÆ°u trá»¯

cÃ¡c dáº¡ng objects dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin trong R bao gá»“m 

- Scalar 
- Vector
- Matrix
- Array
- Data frame
- List

__Scalar__. NhÆ° Ä‘Ã£ nÃ³i, scalar lÃ  Ä‘Æ¡n vá»‹ nhá» nháº¥t ta dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ 1 máº£ng thÃ´ng tin. vÃ­ dá»¥, bá»‡nh nhÃ¢n A 50 tuá»•i, giá»›i tÃ­nh nam, thÃ¬ ta sáº½ code nhÆ° sau 

```{r}
age = 50
sex = "male"
age; sex
```

Náº¿u nhÆ° ta cÃ³ 3 bá»‡nh nhÃ¢n A,B vÃ  C vá»›i cÃ¡c sá»‘ liá»‡u nhÆ° sau 

```{r, echo=FALSE}
tibble(name = LETTERS[1:3], sex = c("M","F","M")%>% factor(), age = c(50,48,60))%>% draw_table()
```

thÃ¬ ta cáº§n dÃ¹ng nhá»¯ng vectors Ä‘á»ƒ lÆ°u trá»¯ tá»«ng loáº¡i biáº¿n, á»Ÿ Ä‘Ã¢y ta cÃ³ 3 biáº¿n lÃ : name, sex vÃ  age.

```{r}
name = c("A","B","C")
sex = factor(c("M","F","M"))
age = c(50,48,60)
name
sex
age
```

Ta Ä‘á»ƒ Ã½ tháº¥y 3 biáº¿n trÃªn thuá»™c 3 loáº¡i biáº¿n khÃ¡c nhau, name lÃ  character, sex lÃ  factor vÃ  age lÃ  numeric(lÆ°u Ã½ numeric bao gá»“m luÃ´n cáº£ integer, nhÆ°ng integer thÃ¬ khÃ´ng thá»ƒ lÃ  numeric). LÆ°u Ã½ vector chá»‰ chá»©a nhá»¯ng scalar cÃ¹ng loáº¡i. 

Sau khi ta Ä‘Ã£ cÃ³ cÃ¡c vectors, náº¿u ta muá»‘n lÆ°u trá»¯ nhiá»u vectors thÃ¬ ta sáº½ cÃ³ data.frame. NhÆ° ta tháº¥y ráº±ng 1 data.frame bao gá»“m nhiá»u vectors cÃ³ cÃ¹ng chiá»u dÃ i. Náº¿u nhÆ° muá»‘n lÆ°u trá»¯ nhá»¯ng vector cÃ³ chiá»u dÃ i khÃ¡c nhau ta cÃ³ thá»ƒ sá»­ dá»¥ng list. Tháº­t ra data.frame chÃ­nh lÃ  1 dáº¡ng Ä‘áº·c biá»‡t cá»§a list Ä‘i kÃ¨m vá»›i Ä‘iá»u kiá»‡n lÃ  chiá»u dÃ i cÃ¡c vector pháº£i nhÆ° nhau.

matrix trong R Ä‘Æ°á»£c xÃ¢y dá»±ng khÃ¡ giá»‘ng vá»›i matrix trong Ä‘áº¡i sá»‘ tuyáº¿n tÃ­nh, khi ta cÃ³ nhu cáº§u tÃ­nh toÃ¡n cÃ¡c matrices thÃ¬ ta cÃ³ thá»ƒ lÆ°u trá»¯ cÃ¡c scalars trong 1 matrix. CÅ©ng nhÆ° vector, matrix Ä‘á»u pháº£i chá»©a cÃ¡c scalar cÃ¹ng loáº¡i. Máº·c dÃ¹ ta cÃ³ thá»ƒ chá»©a cÃ¡c scalar thuá»™c loáº¡i character trong 1 matrix, nhÆ°ng trÃªn thá»±c táº¿ Ä‘iá»u nÃ y Ã­t khi Ä‘Æ°á»£c sá»­ dá»¥ng, vÃ¬ matrix Ä‘Æ°á»£c táº¡o ra lÃ  Ä‘á»ƒ tÃ­nh toÃ¡n, trong khi Ä‘á»‘i vá»›i cÃ¡c scalar dáº¡ng character thÃ¬ ta khÃ´ng cÃ³ nhu cáº§u tÃ­nh toÃ¡n. VÃ¬ tháº¿ Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c characters ta sáº½ dÃ¹ng cÃ¡c vector, data.frame hoáº·c list. 

list lÃ  Ä‘Æ¡n vá»‹ lÆ°u trá»¯ lá»›n nháº¥t vÃ  máº¡nh nháº¥t trong R, nÃ³ cÃ³ thá»ƒ lÆ°u trá»¯ nhiá»u loáº¡i objects khÃ¡c nhau nhÆ° vector, matrix tháº­m chÃ­ lÃ  nhá»¯ng list khÃ¡c. Theo kinh nghiá»‡m báº£n thÃ¢n thÃ¬ mÃ¬nh luÃ´n lÆ°u trá»¯ cÃ¡c thÃ´ng tin báº±ng list vÃ¬ nÃ³ thuáº­n tiá»‡n Ä‘á»ƒ cháº¡y cÃ¡c vÃ²ng loop vá» sau. 

Array lÃ  táº­p há»£p cá»§a nhiá»u matrices, mÃ¬nh Ã­t khi dÃ¹ng array, náº¿u ta cÃ³ nhiá»u matrices thÃ¬ cÃ³ thá»ƒ lÆ°u trá»¯ trong list mÃ  khÃ´ng cáº§n dÃ¹ng tá»›i array. khi thá»±c hiá»‡n cÃ¡c phÃ©p toÃ¡n vá» tuyáº¿n tÃ­nh, thÃ¬ ta cÅ©ng chá»‰ cÃ³ dÃ¹ng tá»›i matrix mÃ  thÃ´i, array Ä‘Æ°á»£c tÃ­nh báº±ng cÃ¡ch táº¡o ra 1 vÃ²ng loop cho cháº¡y tá»«ng matrix cá»§a array Ä‘Ã³. 

```{r}
dat = data.frame(name = name, sex = sex, age = age)
dat2 = list(name = name, sex = sex, age = age)
dat; 
dat2

list3 = list(`luu_tru_data_frame` = dat, `luu_tru_list` = dat2)
list3
```

Trong nhiá»u trÆ°á»ng há»£p ta sáº½ cÃ³ cÃ¡c list náº±m trong list, vÃ¬ tháº¿ ta cÅ©ng sáº½ cÃ³ nhu cáº§u Ä‘á»ƒ _append_ cÃ¡c list trong 1 list tá»•ng nhÆ° sau 

```{r}
list4 = list(sub_list1 = list(a = 1,b=2),sub_list2 = list(x = "a",y = "h")); list4
Reduce(append,list4)
```

hÃ m `Reduce` mÃ¬nh dÃ¹ng á»Ÿ trÃªn lÃ  thuá»™c nhÃ³m cÃ¡c _high level function_ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° lÃ  nhá»¯ng hÃ m sá»‘ cÃ³ thá»ƒ nháº­n má»™t hÃ m sá»‘ khÃ¡c lÃ m biáº¿n. Vá» máº·t toÃ¡n há»c ta cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng nhÆ° lÃ  

$$
f\big[g(x)\big] = f\circ g(x)
$$

## HÃ m sá»‘

Trong R, má»™t hÃ m sá»‘ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a khÃ¡ giá»‘ng vá»›i cÃ¡ch ta Ä‘á»‹nh nghÄ©a má»™t hÃ m sá»‘ toÃ¡n há»c $y = f(x)$. VÃ­ dá»¥ ta muá»‘n Ä‘á»‹nh nghÄ©a má»™t hÃ m sá»‘ sau 

$$
\begin{split}
y &= f(x) &= x^2+1 \\
z  &= g(i,j) &= i+j+1
\end{split}
$$
Ta sáº½ Ä‘á»‹nh nghÄ©a nhÆ° sau 

```{r}
y = function(x){
  result = x^2+1
  return(result)
}

z = function(i,j){
  result = i+j+1
  return(result)
}
```

`return` lÃ  hÃ m tráº£ láº¡i giÃ¡ trá»‹ chung cuá»™c cuá»‘i cÃ¹ng cá»§a 1 hÃ m sá»‘. thÃ´ng thÆ°á»ng R sáº½ tá»± tráº£ vá» giÃ¡ trá»‹ cuá»‘i cÃ¹ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong function Ä‘Ã³, nhÆ°ng Ä‘á»ƒ rÃµ rÃ ng ta hÃ£y luÃ´n Ä‘á»‹nh nghÄ©a giÃ¡ trá»‹ chung cuá»™c vÃ  sá»­ dá»¥ng hÃ m `return` Ä‘á»ƒ tráº£ vá» giÃ¡ trá»‹ mong muá»‘n. 

```{r}
y(2)
z(2,3)
```

# vÃ²ng láº·p (loop)

3 khÃ¡i niá»‡m `list`, `function` vÃ  `loop` ráº¥t quan trá»ng vÃ  tÆ°Æ¡ng tÃ¡c vá»›i nhau cá»±c ká»³ nhiá»u trong suá»‘t quÃ¡ trÃ¬nh lÃ m viá»‡c vá»›i data. BÃ¢y giá» ta sáº½ tÃ¬m hiá»ƒu vá» loop trÆ°á»›c khi ta Ä‘i Ä‘áº¿n pháº§n chÃ­nh cá»§a bÃ i nÃ y.

Trong R, Ä‘á»ƒ Ä‘á»‹nh nghÄ©a 1 vÃ²ng loop ta cÃ³ 3 cÃ¡ch lÃ  

- `for`
- `while`
- `repeat`

TÃ¹y thuá»™c vÃ o nhu cáº§u khÃ¡c nhau mÃ  ta sá»­ dá»¥ng 3 loáº¡i nÃ y khÃ¡c nhau. Ta hÃ£y xem Ä‘á»‹nh nghÄ©a 3 loáº¡i loop trÃªn báº±ng cÃ¡ch xem xÃ©t 1 vÃ­ dá»¥: ta muá»‘n in cÃ¡c giÃ¡ trá»‹ $i$ báº¯t Ä‘áº§u tá»« $i=1$ cho Ä‘áº¿n $i=3$, má»™t khi $i$ lá»›n hÆ¡n $3$ thÃ¬ loop sáº½ dá»«ng láº¡i. 

```{r}

#### for ####
for(i in 1:3){
  print(i)
}

#### while ####
i = 1
while(i<=3){
  print(i)
  i = i+1
}

#### repeat ####
j = 1
repeat{
  print(j)
  j=j+1
  if(j>3) break
}
```

Ta dá»… tháº¥y ráº±ng:

- `for`. ta cáº§n biáº¿t sá»‘ láº§n loop sáº½ cháº¡y, á»Ÿ Ä‘Ã¢y lÃ  3 láº§n, má»—i má»™t láº§n cháº¡y tÆ°Æ¡ng á»©ng vá»›i 1 giÃ¡ trá»‹ cá»§a $i$ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong pháº§n ngoáº·c trÃ²n.
- `while`. check Ä‘iá»u kiá»‡n trÆ°á»›c khi báº¯t Ä‘áº§u cháº¡y, vÃ  Ä‘iá»u kiá»‡n Ä‘Ã³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong ngoáº·c trÃ²n
- `repeat`. cháº¡y rá»“i má»›i check Ä‘iá»u kiá»‡n. vá»›i `repeat` ta cáº§n Ä‘á»‹nh nghÄ©a 1 hÃ m `if` á»Ÿ cuá»‘i Ä‘á»ƒ check, khi Ä‘iá»u kiá»‡n trong `if` thá»a thÃ¬ ta sáº½ `break` vÃ²ng láº·p. 

Cáº£ 3 vÃ²ng loop nÃ y Ä‘á»u cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ cháº¡y trong cáº£ 2 Ä‘iá»u kiá»‡n Ä‘á»™c láº­p vÃ  khÃ´ng Ä‘á»™c láº­p. Äá»ƒ hiá»ƒu giá»¯a vÃ²ng láº·p Ä‘á»™c láº­p vÃ  vÃ²ng láº·p khÃ´ng Ä‘á»™c láº­p ta hÃ£y xem xÃ©t 2 vÃ­ dá»¥ sau 

1. __VÃ²ng láº·p khÃ´ng Ä‘á»™c láº­p.__ VÃ­ dá»¥ ta cÃ³ cáº§n tÃ¬m 1 giÃ¡ trá»‹ cÃ¡ch sá»‘ $5$ lÃ  0.005 Ä‘Æ¡n vá»‹, ta báº¯t Ä‘áº§u tá»« sá»‘ $10$. Ta sáº½ cho vÃ²ng láº­p cháº¡y vá»›i giÃ¡ trá»‹ ban Ä‘áº§u lÃ  $10$, sau má»—i 1 vÃ²ng, giÃ¡ trá»‹ $10$ sáº½ Ä‘Æ°á»£c trá»« Ä‘i $0.001$, cho Ä‘áº¿n khi nÃ o thá»a Ä‘iá»u kiá»‡n thÃ¬ vÃ²n láº·p dá»«ng. Ta lÃ m nhÆ° sau 

```{r}
x = 10
while(x-5 >0.005){
  print(x)
  x = round(x-0.001,3)
}
x
```

Trong vÃ­ dá»¥ trÃªn, ta tháº¥y ráº±ng sau má»—i vÃ²n láº·p thÃ¬ giÃ¡ trá»‹ $x$ Ä‘Æ°á»£c cáº­p nháº­t dá»±a trÃªn giÃ¡ trá»‹ liá»n trÆ°á»›c cá»§a nÃ³. NhÆ° váº­y, giá»¯a cÃ¡c vÃ²ng láº·p cÃ³ sá»± phá»¥ thuá»™c vÃ o nhau. Náº¿u láº§n trÆ°á»›c lÃ  $5.008$, thÃ¬ láº§n sau lÃ  $5.007$, cÃ²n náº¿u láº§n trÆ°á»›c lÃ  $5.007$ thÃ¬ láº§n sau lÃ  $5.006$.

2. __VÃ²ng láº·p Ä‘á»™c láº­p.__ vÃ­ dá»¥ ta cÃ³ giÃ¡ trá»‹ $x =5$, ta muá»‘n trong má»—i vÃ²ng láº·p ta cÃ³ giÃ¡ trá»‹ $x*i$ vá»›i $i = 1,2,\dots,5$.

```{r}
x = 5
for(i in 1:5) print(x*i)
```

á» vÃ­ dá»¥ trÃªn ta tháº¥y ráº±ng trong má»—i vÃ²ng láº·p, giÃ¡ trá»‹ cá»§a $x$ luÃ´n lÃ  $5$, cÃ¡c giÃ¡ trá»‹ tráº£ vá» khÃ¡c nhau phá»¥ thuá»™c vÃ o sá»± thay Ä‘á»•i cá»§a giÃ¡ trá»‹ $i$. VÃ²ng láº­p dáº¡ng nÃ y Ä‘Æ°á»£c xem lÃ  Ä‘á»™c láº­p. 

Äá»‘i vá»›i vÃ²ng láº·p phá»¥ thuá»™c, hay khÃ´ng Ä‘á»™c láº­p, thÃ¬ Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u náº¿u nhÆ° báº¡n lÃ m viá»‡c vá»›i cÃ¡c thuáº­t toÃ¡n. VÃ­ dá»¥ thuá»™c toÃ¡n tÃ¬m Ä‘iá»ƒm nhá» nháº¥t, ta sáº½ pháº£i cho cháº¡y 1 vÃ²ng láº­p, trong má»—i vÃ²ng giÃ¡ trá»‹ cáº§n tÃ¬m sáº½ láº§n lÆ°á»£t Ä‘Æ°á»£c cáº­p nháº­t cho Ä‘áº¿n khi nÃ o nÃ³ thá»a 1 Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³. Trong khi vÃ²ng láº·p Ä‘á»™c láº­p thÃ¬ Ä‘Æ°á»£c sá»­ dá»¥ng khÃ¡ nhiá»u khi ta lÃ m viá»‡c vá»›i data.frame, vector hay list. VÃ­ dá»¥ ta muá»‘n tÃ­nh toÃ¡n cho tá»«ng scalar cá»§a 1 vector, hay tá»«ng cá»™t cá»§a 1 data.frame, hay tá»«ng thÃ nh viÃªn cá»§a 1 list. VÃ¬ tháº¿ R Ä‘Ã£ phÃ¡t triá»ƒn má»™t há»‡ thá»‘ng cÃ¡c hÃ m sá»‘ Ä‘á»ƒ phá»¥c vá»¥ cho nhu cáº§u nÃ y. Theo ngÃ´n ngá»¯ python nÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i hÃ m sá»‘ lambda. 

## VÃ²ng láº·p Ä‘á»™c láº­p 

trong há»‡ thá»‘ng cÃ¡c hÃ m chuáº©n cá»§a R, ta cÃ³ cÃ¡c hÃ m `apply`, Ä‘Æ°á»£c xem lÃ  gia Ä‘Ã¬nh há» `apply`, bao gá»“m 

- `apply`: thÆ°á»ng sá»­ dá»¥ng Ä‘á»ƒ tÃ­nh toÃ¡n dá»c theo cá»™t hay dá»c theo hÃ ng cá»§a má»™t matrix. Ä‘áº§u ra cá»§a tá»«ng vÃ²ng lÃ  tá»«ng scalar hay 1 vector. 
- `sapply`: Ä‘áº§u vÃ o lÃ  vector, data.frame, list. Äáº§u ra cá»§a tá»«ng vÃ²ng pháº£i lÃ  scalar hay 1 vector.
- `lapply`: thÃ nh viÃªn máº¡nh nháº¥t cá»§a gia Ä‘Ã¬nh apply, Ä‘áº§u vÃ o nhÆ° sapply Ä‘áº§u ra lÃ  báº¥t cá»© dáº¡ng object nÃ o.

NgoÃ i 3 thÃ nh viÃªn trÃªn gia Ä‘Ã¬nh apply cÃ²n vÃ i thÃ nh viÃªn khÃ¡c nhÆ° mapply, tapply, vapply, eapply... nhÆ°ng nhá»¯ng hÃ m nÃ y khÃ´ng thÃ´ng dá»¥ng. cÃ³ thá»i gian chÃºng ta sáº½ bÃ n tá»›i nhá»¯ng hÃ m nÃ y sau. 

Äá»‘i vá»›i apply vÃ  sapply, náº¿u Ä‘áº§u ra cá»§a tá»«ng vÃ²ng lÃ  scalar thÃ¬ táº¥t cáº£ scalar cá»§a tá»«ng vÃ²ng sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ thÃ nh 1 vector, cÃ²n náº¿u má»—i vÃ²ng lÃ  1 vector thÃ¬ cÃ¡c vector sáº½ Ä‘Æ°á»£c lÆ°u thÃ nh 1 matrix. Vá»›i hÃ m lapply, táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ tráº£ vá» trong tá»«ng vÃ²ng láº­p sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ thÃ nh 1 list. VÃ  nhÆ° ta Ä‘Ã£ Ä‘á» cáº·p, list lÃ  hÃ m lÆ°u trá»¯ máº¡nh nháº¥t trong R vÃ¬ nÃ³ cÃ³ thá»ƒ lÆ°u trá»¯ báº¥t cá»© thá»© gÃ¬, á»Ÿ báº¥t cá»© dáº¡ng nÃ o. Ta hÃ£y xem xÃ©p vÃ i vÃ­ dá»¥

```{r}
m = matrix(c(1:9),ncol = 3);m
```

Ta muá»‘n tÃ­nh tá»•ng cá»§a tá»«ng cá»™t vÃ  tá»«ng hÃ ng

```{r}
# column
apply(m,2,function(i) sum(i))
```
HÃ m sá»‘ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong hÃ m apply nháº­n giÃ¡ trá»‹ $i$ lÃ  tá»«ng cá»™t cá»§a matrix `m`. 

TÆ°Æ¡ng tá»± cho tá»«ng hÃ ng

```{r}
apply(m,1,function(i) sum(i))
```

Ta hÃ£y xem náº¿u trong má»—i vÃ²ng láº·p ta chá»n ra 2 giÃ¡ trá»‹ Ä‘áº§u tiÃªn cá»§a 1 cá»™t

```{r}
apply(m,2, function(i) i[1:2] )
```

LÆ°u Ã½, má»—i vector trong tá»«ng vÃ²ng sáº½ táº¡o thÃ nh tá»«ng cá»™t trong matrix káº¿t quáº£. 

vÃ­ dá»¥ tiáº¿p theo 

```{r}
x = 1:5
d = data.frame(a = 1:2,b = 3:4)
l = list(a = 1:2, b = 1:4)
```

Sá»­ dá»¥ng sapply Ä‘á»ƒ nhÃ¢n má»—i giÃ¡ trá»‹ trong `x` vá»›i $5$ (Ä‘áº§u ra scalar)

```{r}
sapply(x,function(i) i*5)
```

láº­p láº¡i giÃ¡ trá»‹ cá»§a `x` 3 láº§n (Ä‘áº§u ra lÃ  vector cÃ¹ng chiá»u dÃ i lÃ  3)

```{r}
sapply(x, function(i) rep(i,3))
```

Sá»­ dá»¥ng sapply cho data.frame vÃ  list 

```{r}
sapply(d, function(i) sum(i)) # hoáº·c Ä‘Æ¡n giáº£n lÃ  sapply(d, sum)
sapply(l, function(i) sum(i))
```

Sá»­ dá»¥ng lapply láº­p láº¡i `"a"` x láº§n (Ä‘áº§u ra lÃ  scalar vÃ  vector cÃ³ chiá»u dÃ i khÃ´ng báº±ng nhau)

```{r}
lapply(x, function(i) rep("a",i))
```

TÆ°Æ¡ng tá»± 

```{r}
lapply(l, function(i) sum(i))
```

VÃ­ dá»¥ ta cÃ³ 3 vector nhÆ° sau 

```{r}
a = c(1:3); b = c(4:6); k = c(7:9)
```

Ta muá»‘n cá»™ng má»—i giÃ¡ trá»‹ cá»§a tá»«ng vector theo thá»© tá»± lÃ  $1+4+7$, $2+5+8$ vÃ  $3+6+9$. Ta dÃ¹ng lÃ m `mapply`

```{r}
mapply(function(x,y,z) x+y+z, a,b,k)
mapply(function(x,y) rep(x,y),a,b)
mapply(function(x,y,z) c(x,y,z), a,b,k )
```
Trong 3 vÃ­ dá»¥ trÃªn ta tháº¥y ráº±ng tÃ¹y thuá»™c vÃ o Ä‘áº§u ra cá»§a tá»«ng vÃ²ng mÃ  hÃ m `mapply` sáº½ lÆ°u trá»¯ cÃ¡c giÃ¡ trá»‹ á»Ÿ cÃ¡c dáº¡ng khÃ¡c nhau (nÃ³ tÆ°Æ¡ng tá»± nhÆ° sapply). Má»™t hÃ m ná»¯a Ä‘Ã¡ng quan tÃ¢m lÃ  hÃ m `Map`, cÅ©ng nhÆ° lapply `Map` luÃ´n lÆ°u trá»¯ cÃ¡c giÃ¡ trá»‹ trong list, tuy nhiÃªn cÃ¡ch sá»­ dá»¥ng khÃ¡ giá»‘ng `mapply`

```{r}
Map(function(x,y,z) x+y+z, a,b,k)
Map(function(x,y) rep(x,y),a,b)
Map(function(x,y,z) c(x,y,z), a,b,k )
```

ThÃ´ng thÆ°á»ng hÃ m `lapply` vÃ  `Map` Ä‘Æ°á»£c mong Ä‘á»£i sá»­ dá»¥ng hÆ¡n cÃ¡c hÃ m cÃ²n láº¡i, vÃ¬ nÃ³ luÃ´n tráº£ láº¡i 1 list, vÃ¬ tháº¿ báº¥t ká»ƒ káº¿t quáº£ trong tá»«ng vÃ²ng nhÆ° tháº¿ nÃ o, 2 hÃ m nÃ y luÃ´n cho ta má»™t káº¿t quáº£ nhÆ° mong Ä‘á»£i. Trong khi Ä‘Ã³, Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c hÃ m cÃ²n láº¡i, ta pháº£i biáº¿t rÃµ káº¿t quáº£ tráº£ láº¡i trong tá»«ng vÃ²ng lÃ  gÃ¬, vÃ¬ tÃ¹y thuá»™c vÃ o káº¿t quáº£ Ä‘Ã³ mÃ  dáº¡ng lÆ°u trá»¯ Ä‘Æ°á»£c sá»­ dá»¥ng khÃ¡c nhau. 

VÃ¬ nhu cáº§u sá»­ dá»¥ng vÃ²ng láº·p Ä‘á»™c láº­p lÃ  khÃ¡ thÆ°á»ng xuyÃªn nÃªn trong há»‡ thá»‘ng cÃ¡c packages `tidyverse` cÃ³ package `purrr` há»• trá»£ má»¥c Ä‘Ã­ch nÃ y. `purrr` cÃ³ háº³n 1 gia Ä‘Ã¬nh `map` (tÆ°Æ¡ng tá»± apply nhÆ°ng Ä‘a dáº¡ng hÆ¡n) vÃ  kÃ¨m theo cÃ¡c hÃ m sá»‘ vÃ´ cÃ¹ng há»¯u Ã­ch phá»¥c vá»¥ cho gia Ä‘Ã¬nh `map`. Trong bÃ i sau ta sáº½ lÃ m quen vá»›i `purrr`. Giá» ta sáº½ xem qua 1 sá»‘ vÃ­ dá»¥ minh há»a vá»›i data thá»±c táº¿

# VÃ­ dá»¥ 

Ta cÃ³ dataset nhÆ° bÃªn dÆ°á»›i

```{r}
dat = iris;
head(dat)
```

ta muá»‘n tÃ­nh mean cá»§a 4 cá»™t Ä‘áº§u tiÃªn: _loop cháº¡y tá»«ng cá»™t_

```{r}
lapply(dat[,1:4], function(i) mean(i))%>%
  as.data.frame()
```

`lapply` tráº£ láº¡i 1 list, nhÆ°ng má»—i giÃ¡ trá»‹ trong list lÃ  1 scalar cÃ³ tÃªn, nÃªn ta cÃ³ thá»ƒ biáº¿n Ä‘á»•i tá»« list vá» láº¡i data.frame dá»… dÃ ng báº±ng hÃ m `as.data.frame`. 

Ta hÃ£y lÃ m quen thÃªm 1 hÃ m ná»¯a lÃ  hÃ m `tapply`, sá»­ dá»¥ng Ä‘á»ƒ tÃ­nh má»™t giÃ¡ trá»‹ nÃ o Ä‘Ã³ theo nhÃ³m. VÃ­ dá»¥ ta ta xem xÃ©t 2 cá»™t cuá»‘i cÃ¹ng cá»§a data trÃªn 

```{r}
dat$Petal.Width
table(dat$Species)
```

Cá»™t _petal.Width_ lÃ  cÃ¡c sá»‘ dáº¡ng numeric Ä‘Æ°á»£c phÃ¢n thÃ nh 3 nhÃ³m bá»Ÿi cá»™t `Species` vá»›i má»—i nhÃ³m chá»©a 50 giÃ¡ trá»‹. Ta muá»‘n tÃ­nh `mean` tá»«ng nhÃ³m, ta lÃ m nhÆ° sau 

```{r}
tapply(dat$Petal.Width,dat$Species, function(i) mean(i)) # hoáº·c tapply(dat$Petal.Width,dat$Species, mean)
```

Ta hÃ£y tÃ­nh mean cá»§a tá»«ng nhÃ³m trong 4 cá»™t Ä‘áº§u tiÃªn, ta lÃ m nhÆ° sau 

```{r}
lapply(dat[,1:4], function(i) tapply(i,dat$Species,mean))
```

Ta  láº¥y cÃ¡c giÃ¡ trá»‹ láº§n lÆ°á»£t cá»§a 3 cá»™t Ä‘áº§u tiÃªn tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i 3 nhÃ³m cá»§a cá»™t thá»© 5. NghÄ©a lÃ  vá»›i cá»™t `Sepal.Length` ta láº¥y cÃ¡c giÃ¡ trá»‹ thuá»™c nhÃ³m `setosa`, láº¥y cÃ¡c giÃ¡ trá»‹ cá»§a cá»™t `Sepal.Width` thuá»™c nhÃ³m `versicolor` vÃ  tÆ°Æ¡ng tá»± cho cá»™t thá»© 3 vá»›i nhÃ³m cÃ²n láº¡i.

```{r}
Map(function(x,y) x[dat$Species==y] ,dat[,1:3], c("setosa","versicolor", "virginica") )
```

CÅ©ng cÃ³ thá»ƒ lÃ m nhÆ° sau 

```{r}
Map(function(x,y) dat[dat$Species==y,c(x,5)] ,1:3,c("setosa","versicolor", "virginica"))
```

Tháº­t ra nhá»¯ng gÃ¬ ta tÃ­nh trong pháº§n vÃ­ dá»¥ nÃ y Ä‘á»u cÃ³ thá»ƒ tÃ­nh toÃ¡n má»™t cÃ¡ch dá»… dÃ ng hÆ¡n vá»›i sá»± trá»£ giÃºp cá»§a package `dplyr` má»™t thÃ nh viÃªn trong gia Ä‘Ã¬nh `tidyverse`. NhÆ°ng vá»›i má»¥c Ä‘Ã­ch minh há»a ta sáº½ tÃ­nh theo cÃ¡c cÃ¡ch nhÆ° trÃªn. 






